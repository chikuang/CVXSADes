partial_deri <- function(x, w){
  w * (c(1,x,x^2,x^3) %o% c(1,x,x^2,x^3))
}
calc_loss <- function(design){
  point <- design[1,]
  weight <- design[2, ]
  n_point <- length(point)
  FIM <- matrix(0, nrow = 4, ncol = 4)
  for(i in 1:n_point){
    print(partial_deri(point[i], weight[i]))
    FIM <- FIM + partial_deri(point[i], weight[i])
  }
  -log(det(FIM))
}

# N21 n20 -----------------------------------------------------------------
N <- 21; n <- 20; #seed 135
design_app <- matrix(c(-1, -0.5, -0.4, 0.4  ,0.5, 1, 
                       0.2495,    0.1129,    0.1376,    0.1376,    0.1129,    0.2495),
                     byrow = T, nrow = 2)
design_ex <- matrix(c(-1, -0.4504, -0.4503, -0.4485, -0.4478, -0.4450, 0.4442, 0.4450, 0.4478, 0.4495, 1,
                    5,    1,    1,    1,    1,    1,    1,    1,    2,    1,    5),
                    byrow=T, nrow = 2)



loss_appr <- 1.3224
loss_ex <- 1.3187


# N21m n18 ----------------------------------------------------------------
N <- 21; n <- 18;  #seed 284
design_app <- matrix(c(-1, -0.5, -0.4, 0.4  ,0.5, 1, 
                       0.2495,    0.1129,    0.1376,    0.1376,    0.1129,    0.2495),
                     byrow = T, nrow = 2)


design_ex <- matrix(c(-1, -0.4504, -0.45, -0.4483, -0.4415, -0.4405, 0.4439, 0.4463,
                      0.4501, 0.4506, 0.4515, 1,
                      4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4),
                    byrow = T, nrow = 2)



loss_appr <- 1.3224
loss_ex <- 1.3249

# N 51, n 20 --------------------------------------------------------------
N <- 51; n <- 20;
loss_appr <- 1.3188
loss_ex <- 1.3187



# N 51 n18 ----------------------------------------------------------------
loss_appr <- 1.31881
loss_ex <- 1.3249

-1        -0.44         0.44            1
0.25         0.25         0.25         0.25
